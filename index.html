<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<title>刀大厨的菜单</title>
	<link rel="icon" href="https://www.emojiall.com/images/240/apple/1f373.png" type="image/png"/>
	
	<style>
		/* --- 全局与色彩系统 --- */
		:root {
			--bg-color: #e8e6e1;
			--text-color: #1a1a1a;
			--accent-gold: #b08d57;
			--card-bg: #fff;
			--transition-smooth: cubic-bezier(0.25, 1, 0.5, 1);
			/* 统一按钮字体变量 */
			--btn-font: 'Helvetica', Arial, sans-serif;
		}

		*, *::before, *::after { box-sizing: border-box; }

		body {
			font-family: 'Times New Roman', Times, serif; 
			margin: 0; padding: 0;
			background-color: var(--bg-color);
			color: var(--text-color);
			display: flex; flex-direction: column; align-items: center;
			overflow-x: hidden;
			-webkit-font-smoothing: antialiased;
		}

		/* --- 主内容容器：移除顶部空隙 --- */
		#albums-container {
			width: 100%;
			max-width: 1200px; 
			display: none; 
			flex-direction: column;
			align-items: center;
			opacity: 0;
			transition: opacity 1s ease;
			padding: 0 0 80px 0; /* 顶部设为 0，底部保留空间 */
		}

		body.content-visible #albums-container { display: flex; opacity: 1; }

		/* --- 专辑行 (强制 1:1) --- */
		.album-row {
			display: flex; 
			width: 100%; 
			aspect-ratio: 2 / 1; 
			background-color: var(--card-bg);
			margin: 0; position: relative;
			opacity: 0; transform: translateY(30px);
			transition: opacity 0.8s var(--transition-smooth), transform 0.8s var(--transition-smooth);
			overflow: hidden;
			border-bottom: 1px solid rgba(0,0,0,0.03);
		}
		
		@media (min-width: 1000px) { .album-row { aspect-ratio: auto; height: 550px; } }
		.album-row.is-visible { opacity: 1; transform: translateY(0); }
		.album-row.reverse { flex-direction: row-reverse; }

		.album-cover { flex: 0 0 50%; height: 100%; position: relative; overflow: hidden; }
		.album-cover img { width: 100%; height: 100%; object-fit: cover; transition: transform 1.5s var(--transition-smooth); display: block; }
		.album-cover:hover img { transform: scale(1.08); }

		.album-info { flex: 0 0 50%; display: flex; justify-content: center; align-items: center; padding: 20px; }
		.album-info-inner { text-align: center; width: 100%; }

		.year { 
			display: block; font-family: 'Helvetica', sans-serif; font-size: clamp(10px, 2.2vw, 14px); 
			color: #888; letter-spacing: 5px; margin-bottom: 15px; font-weight: 300;
		}
		h3 { 
			font-size: clamp(12px, 2.8vw, 18px); font-weight: 400; color: var(--accent-gold); 
			margin: 0 0 10px 0; letter-spacing: 2px; text-transform: uppercase;
		}
		h2 { 
			font-size: clamp(16px, 4.2vw, 38px); font-weight: 300; line-height: 1.2; 
			margin: 0; color: #000; word-break: break-word;
		}
		.album-info-inner::before { content: ''; display: block; width: 25px; height: 1px; background: var(--accent-gold); margin: 0 auto 15px; }

		/* --- 角标星标 --- */
		.highlight { position: absolute; top: 0; right: 0; width: 80px; height: 80px; z-index: 10; pointer-events: none; }
		.highlight::before {
			content: ''; position: absolute; top: 0; right: 0;
			border-top: 80px solid var(--accent-gold); border-right: 80px solid transparent;
			transform: rotate(90deg); opacity: 0.9;
		}
		.highlight span {
			position: absolute; top: 0; right: 0; width: 40px; height: 40px;
			display: flex; justify-content: center; align-items: center;
			font-size: 20px; color: #fff; animation: pulse-star 2.5s infinite ease-in-out;
		}
		@keyframes pulse-star { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

		/* --- 开场动画网格 --- */
		#intro-overlay {
			position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
			background-color: var(--bg-color); z-index: 9999;
			display: none; justify-content: center; align-items: center;
			opacity: 0; transition: opacity 0.8s ease-out; overflow: hidden;
		}
		body.show-intro { overflow: hidden; }
		body.show-intro #intro-overlay { display: flex; opacity: 1; }

		#intro-grid {
			display: grid; position: absolute; top: 0; left: 0; width: 100%;
			grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
			filter: brightness(0.5) grayscale(0.2);
		}
		@media (max-width: 600px) { #intro-grid { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); } }

		.grid-cell { position: relative; width: 100%; aspect-ratio: 1/1; perspective: 1000px; background-color: #ddd; }
		.grid-cell-inner { position: relative; width: 100%; height: 100%; transition: transform 1.2s cubic-bezier(0.4, 0.2, 0.2, 1); transform-style: preserve-3d; }
		.grid-cell.flipped .grid-cell-inner { transform: rotateY(180deg); }
		.grid-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; -webkit-backface-visibility: hidden; }
		.grid-face img { width: 100%; height: 100%; object-fit: cover; display: block; }
		.grid-back { transform: rotateY(180deg); }

		/* --- 开场按钮：强制字体一致 --- */
		#intro-buttons {
			position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9);
			display: flex; gap: 20px; z-index: 10000; opacity: 0;
			transition: all 0.8s var(--transition-smooth);
		}
		#intro-buttons.visible { opacity: 1; transform: translate(-50%, -50%) scale(1); }

		.intro-btn {
			/* 核心修复：强制重置按钮和链接的默认样式 */
			font-family: var(--btn-font) !important; 
			font-size: 14px; 
			font-weight: 600; 
			line-height: 1.2;
			letter-spacing: 3px;
			text-transform: uppercase;
			color: #fff; 
			background: rgba(0, 0, 0, 0.75);
			border: 1px solid rgba(255, 255, 255, 0.3); 
			border-radius: 50px; 
			cursor: pointer;
			text-decoration: none; 
			backdrop-filter: blur(10px); 
			transition: 0.3s; 
			text-align: center;
			padding: 18px 40px;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			outline: none;
			-webkit-appearance: none;
		}
		.intro-btn:hover { background: #fff; color: #000; transform: translateY(-2px); border-color: #fff; }

		@media (max-width: 600px) {
			#intro-buttons { flex-direction: column; width: 80%; }
			.intro-btn { width: 100%; padding: 15px; font-size: 13px; }
		}
	</style>
</head>
<body>

	<div id="intro-overlay">
		<div id="intro-grid"></div>
	</div>

	<div id="intro-buttons">
		<button id="enter-site-btn" class="intro-btn">Enter Menu</button>
		<a href="https://cookdao.github.io/pricing/" class="intro-btn">See Pricing</a>
	</div>

	<div id="albums-container"></div>

	<script src="albums.js"></script>

	<script>
		let priorityAlbums = [];
		let normalAlbums = [];
		if (typeof albums !== 'undefined') {
			albums.forEach(a => {
				if (a.highlighted || a.year === "2025") priorityAlbums.push(a);
				else normalAlbums.push(a);
			});
		}

		function shuffleArray(array) {
			let arr = [...array];
			for (let i = arr.length - 1; i > 0; i--) {
				const j = Math.floor(Math.random() * (i + 1));
				[arr[i], arr[j]] = [arr[j], arr[i]];
			}
			return arr;
		}

		function getWeightedRandomImage() {
			if (typeof albums === 'undefined') return "";
			const isPriority = Math.random() < 0.7;
			if (isPriority && priorityAlbums.length > 0) {
				return priorityAlbums[Math.floor(Math.random() * priorityAlbums.length)].image;
			}
			return albums[Math.floor(Math.random() * albums.length)].image;
		}

		function generateAlbums() {
			const container = document.getElementById("albums-container");
			if (!container || typeof albums === 'undefined') return;

			container.innerHTML = albums.map((album, index) => `
				<div class="album-row ${index % 2 !== 0 ? 'reverse' : ''}">
					<div class="album-cover">
						<a href="${album.link}" target="_blank">
							<img src="${album.image}" alt="${album.title}" loading="${index < 2 ? 'eager' : 'lazy'}">
							${album.highlighted ? '<div class="highlight"><span>★</span></div>' : ''}
						</a>
					</div>
					<div class="album-info">
						<div class="album-info-inner">
							<span class="year">${album.year}</span>
							<h3>${album.artist}</h3>
							<h2>${album.title}</h2>
						</div>
					</div>
				</div>
			`).join('');
		}

		function initScrollObserver() {
			const observer = new IntersectionObserver((entries) => {
				entries.forEach(entry => {
					if (entry.isIntersecting) {
						entry.target.classList.add('is-visible');
						observer.unobserve(entry.target);
					}
				});
			}, { threshold: 0.1 });
			document.querySelectorAll('.album-row').forEach(row => observer.observe(row));
		}

		let flipInterval;
		function initIntroGrid() {
			const grid = document.getElementById('intro-grid');
			const width = window.innerWidth;
			const height = window.innerHeight;
			const minColWidth = width <= 600 ? 100 : 200;
			const cols = Math.ceil(width / minColWidth);
			const rows = Math.ceil(height / (width / cols)) + 1;
			const totalCells = cols * rows;

			let displayQueue = [...shuffleArray(priorityAlbums), ...shuffleArray(normalAlbums)];
			let cellsHTML = '';

			for (let i = 0; i < totalCells; i++) {
				const imgUrl = (displayQueue[i % displayQueue.length] || {}).image || "";
				cellsHTML += `
					<div class="grid-cell">
						<div class="grid-cell-inner">
							<div class="grid-face grid-front"><img src="${imgUrl}"></div>
							<div class="grid-face grid-back"><img src=""></div>
						</div>
					</div>`;
			}
			grid.innerHTML = cellsHTML;
		}

		function startGridAnimation() {
			flipInterval = setInterval(() => {
				const cells = document.querySelectorAll('.grid-cell');
				if (cells.length === 0) return;
				const randomCell = cells[Math.floor(Math.random() * cells.length)];
				const inner = randomCell.querySelector('.grid-cell-inner');
				const isFlipped = randomCell.classList.contains('flipped');
				const nextImg = randomCell.querySelector(isFlipped ? '.grid-front img' : '.grid-back img');
				
				nextImg.src = getWeightedRandomImage();
				randomCell.classList.toggle('flipped');
			}, 2000);
		}

		function enterSite() {
			if (flipInterval) clearInterval(flipInterval);
			const buttons = document.getElementById("intro-buttons");
			const overlay = document.getElementById("intro-overlay");
			
			buttons.classList.remove("visible");
			overlay.style.opacity = '0';
			
			setTimeout(() => {
				overlay.style.display = 'none';
				buttons.style.display = 'none';
			}, 800);

			document.body.classList.remove('show-intro');
			document.body.classList.add('content-visible');
			sessionStorage.setItem('hasVisited', 'true');
			initScrollObserver();
		}

		document.addEventListener("DOMContentLoaded", () => {
			generateAlbums();
			const hasVisited = sessionStorage.getItem('hasVisited');
			
			document.body.classList.add('show-intro');
			initIntroGrid();
			startGridAnimation();

			setTimeout(() => {
				document.getElementById("intro-buttons").classList.add("visible");
			}, 1000);

			document.getElementById('enter-site-btn').addEventListener('click', enterSite);
		});
	</script>
</body>
</html>
